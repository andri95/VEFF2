<!DOCTYPE html>
<html lang="en">

<head>
    <title>Axios example</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <!-- We need to import Axios in order to be able to use the axios object below -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
    <div class="menu">
        <h1>MINESWEEPAH</h1>
        <br>
        <input type="text" placeholder="Rows..." onfocus="this.value=''" id="rows">
        <input type="text" placeholder="Columns..." onfocus="this.value=''" id="cols">
        <input type="text" placeholder="Mines..." onfocus="this.value=''" id="mines">
        <!-- Clicking this button calls doAjax(), which will do an AJAX request -->
        <button type="button" onclick="doAjax()">Get Board!</button>
    </div>
    <div id="game">

    </div>

    <script>
        function doAjax() {
            // object created with input text as attributes
            var board = {
                rows: document.getElementById("rows").value,
                cols: document.getElementById("cols").value,
                mines: document.getElementById("mines").value,
            };

            function validateBoard(){
                // Check if the board is valid
                var keys = Object.values(board);
                for(var key of keys){
                    if(isNaN(key) || key > 40){
                        console.log(key);
                        board.rows = 10;
                        board.cols = 10;
                        board.mines = 10;
                        break;
                    } else {
                        continue;
                    }
                }
            };
            validateBoard();

            //The URL to which we will send the request
            url = 'https://veff213-minesweeper.herokuapp.com/api/v1/minesweeper'

            //Perform an AJAX POST request to the url, and set the param 'myParam' in the request body to paramValue
            axios.post(url, { rows: board.rows, cols: board.cols, mines: board.mines })
                .then(function(response) {processAjax(response);})
                .catch(function (error) {
                    //When unsuccessful, print the error.
                    console.log(error);
                })
                .then(function () {
                    // This code is always executed, independent of whether the request succeeds or fails.
                });
        }
        function processAjax(response){
            //When successful, print 'Success: ' and the received data
            console.log("Success: ", response.data);
            var container = document.getElementById("game");
            var displayRows = response.data.board.rows;
            var displayCols = response.data.board.cols;
            var placeMines = response.data.board.minePositions;
            var mineCount = response.data.board.mines
            var boardArry = [];
            var mineArray = [];
            document.getElementById("game").innerHTML = "";
            console.log("MINES ", placeMines);
            for(var i = 0; i <= displayRows - 1; i++){
                for(var j = 0; j <= displayCols - 1; j++){
                    var currentButton = document.createElement("button");
                    var id = i + ',' + j;
                    currentButton.setAttribute("id", id);
                    currentButton.setAttribute('class', 'box');
                    currentButton.addEventListener('contextmenu', e => {
                        e.preventDefault();
                    });
                    currentButton.addEventListener('click', e => {
                        checkClick(e.target.id, placeMines)
                    });
                    container.appendChild(currentButton);
                    boardArry.push([i,j]);   
                }
                var newLine = document.createElement("br");
                container.appendChild(newLine);
            }
            for(var x = 0; x<mineCount; x++){
                mineArray.push(placeMines[x]);
            }
            console.log("ARRAY",mineArray)
        }

        function checkClick(clicked_id, placeMines){
            var idList = clicked_id.split(',');
            var intList = idList.map(Number);
            var bombImg = document.createElement("IMG");
            if(event.which === 1){
                for(var i = 0; i < placeMines.length; i++){
                    console.log(intList, placeMines[i])
                    if(intList[0] === placeMines[i][0] && intList[1] === placeMines[i][1]){
                        console.log('Bomb!')
                        //alert("GAME OVER !")
                    }
                }
            }
            if(event.which === 3){
                console.log('hÃ¦gri')
            }
        }
        function updateLeft(clicked_id){

        }
    </script>
</body>

</html>